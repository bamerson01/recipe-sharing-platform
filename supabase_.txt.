# 0 One-time: install & link
npm i -D supabase            # or use npx for ad-hoc
npx supabase login --token "sbp_5cb286db445adb3dfecbb115e67b53694cb5acdb"
npx supabase link --project-ref "pmfqtxmnbpmjhnfwrohx"

# 1 Make a folder for the pack
mkdir -p supabase/export

# 2 Export TypeScript types (public schema only)
npx supabase gen types typescript \
  --project-id "pmfqtxmnbpmjhnfwrohx" \
  --schema public \
  > supabase/export/public.types.ts

# 3 Export RLS policies into a compact CSV
psql "https://pmfqtxmnbpmjhnfwrohx.supabase.co" -c "\copy (
  SELECT tablename, cmd, roles, policyname,
         COALESCE(qual,'')       AS using,
         COALESCE(with_check,'') AS with_check
  FROM pg_policies
  WHERE schemaname = 'public'
  ORDER BY tablename, policyname
) TO 'supabase/export/rls_policies.csv' CSV HEADER"

# (Optional) 4 Storage buckets snapshot (useful if your app touches Storage)
psql "$DB_URL" -Atc "
SELECT jsonb_pretty(jsonb_agg(to_jsonb(b))) FROM storage.buckets b;
" > supabase/export/storage.buckets.json
